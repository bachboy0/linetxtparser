# LINE トーク履歴パーサー

LINEのエクスポートしたトーク履歴テキストファイルをJSONL（JSON Lines）形式に変換するPythonスクリプトです。

## 機能

- LINEのトーク履歴テキストをパース
- JSONL形式で出力（1行1メッセージ）
- ユーザー名とメッセージの正確な分離
- 複数行メッセージのサポート
- メッセージ内の時刻表記（イベント情報など）を正しく処理
- LINEシステムメッセージ（送信取り消しなど）の適切な処理
- 「画像」のみのメッセージを自動除外
- 複数ファイルの一括処理
- 処理統計の表示（メッセージ数、除外数）

## 必要な環境

- Python 3.9以上

## 使い方

### 1. トーク履歴ファイルを配置

`targets/` ディレクトリにLINEのトーク履歴テキストファイル（.txt）を配置してください。

```bash
targets/
  ├── target1.txt
  ├── target2.txt
  └── ...
```

### 2. スクリプトを実行

```bash
python main.py
```

### 3. 結果を確認

パース結果は `output/` ディレクトリにJSONL形式で出力されます。

```bash
output/
  ├── target1.jsonl
  ├── target2.jsonl
  └── ...
```

## 出力形式

各行は以下の形式のJSONオブジェクトです：

```json
{
  "date": "2026.01.09",
  "day": "金曜日",
  "time": "01:55",
  "user": "だにえる",
  "message": "あびこ1台\n長居２台"
}
```

### フィールド説明

- `date`: メッセージの日付（YYYY.MM.DD形式）
- `day`: 曜日
- `time`: メッセージの時刻（HH:MM形式）
- `user`: メッセージを送信したユーザー名
- `message`: メッセージ本文（複数行の場合は改行文字で結合）

## 入力ファイル形式

LINEのトーク履歴エクスポート形式に対応しています：

```
2026.01.09 金曜日
01:54 DANIELがメッセージの送信を取り消しました
01:55 だにえる あびこ1台
長居２台
02:03 デイビッド スカイオ6台
```

### サポートされる機能

- 日付と曜日の認識
- 時刻、ユーザー名、メッセージの分離
- 複数行メッセージのグルーピング
- システムメッセージ（送信取り消しなど）の適切な処理
- 「画像」のみのメッセージの自動除外
- メッセージ内の時刻表記を正しく処理

### メッセージ内の時刻表記の処理

イベント情報などで、メッセージ内に「18:00 開演」「22:30 終」のような時刻表記が含まれる場合も正しく処理します。

**例**: 以下のような長いイベント情報も一つのメッセージとして正しく認識されます：

```
06:20 Nakayamaken イベント』1月9日
城ホール 18:00 開演 NCT DREAM
フェスティバル 18:30 開演 UNISON SQUARE GARDEN
スカイビル　22:30 終
```

パーサーは「開演」「終」「開場」などのキーワードで始まる行を、新しいメッセージではなく前のメッセージの続きとして認識します。

### 除外されるメッセージ

以下のメッセージは自動的に除外されます：
- 内容が「画像」のみのメッセージ

**注意**: 「Yuuki新人 画像」のように、「画像」以外のテキストを含む場合は除外されません。

## ライセンス

MIT License
